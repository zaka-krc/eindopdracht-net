<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:SuntoryManagementSystem.Models;assembly=SuntoryManagementSystem_Models"
             x:Class="SuntoryManagementSystem_App.Pages.DeliveryDetailPage"
             x:DataType="pages:DeliveryDetailPage"
             Title="Levering Details"
             BackgroundColor="White">
    
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            
            <!-- Type Selectie -->
            <Label Text="Type Levering"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#424242"/>
            <Picker x:Name="TypePicker"
                    BackgroundColor="#F5F5F5"
                    SelectedIndexChanged="OnTypePickerChanged">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Incoming</x:String>
                        <x:String>Outgoing</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>
            
            <!-- Referentie Nummer -->
            <Label Text="Referentienummer *"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#424242"/>
            <Entry x:Name="ReferenceNumberEntry"
                   Placeholder="Bijv. INC-2025-001"
                   BackgroundColor="#F5F5F5"/>
            
            <!-- Supplier (alleen voor Incoming) -->
            <Label x:Name="SupplierLabel"
                   Text="Leverancier"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#424242"/>
            <Picker x:Name="SupplierPicker"
                    x:DataType="models:Supplier"
                    BackgroundColor="#F5F5F5"
                    ItemDisplayBinding="{Binding SupplierName}"/>
            
            <!-- Customer (alleen voor Outgoing) -->
            <Label x:Name="CustomerLabel"
                   Text="Klant"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#424242"
                   IsVisible="False"/>
            <Picker x:Name="CustomerPicker"
                    x:DataType="models:Customer"
                    BackgroundColor="#F5F5F5"
                    ItemDisplayBinding="{Binding CustomerName}"
                    IsVisible="False"/>
            
            <!-- Vehicle -->
            <Label Text="Voertuig (optioneel)"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#424242"/>
            <Picker x:Name="VehiclePicker"
                    x:DataType="models:Vehicle"
                    BackgroundColor="#F5F5F5"
                    ItemDisplayBinding="{Binding LicensePlate}"/>
            
            <!-- Verwachte Leverdatum -->
            <Label Text="Verwachte Leverdatum *"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#424242"/>
            <DatePicker x:Name="ExpectedDatePicker"
                        BackgroundColor="#F5F5F5"/>
            
            <!-- Status -->
            <Label Text="Status"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#424242"/>
            <Picker x:Name="StatusPicker"
                    BackgroundColor="#F5F5F5">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Gepland</x:String>
                        <x:String>Delivered</x:String>
                        <x:String>Geannuleerd</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>
            
            <!-- Opmerkingen -->
            <Label Text="Opmerkingen"
                   FontSize="14"
                   FontAttributes="Bold"
                   TextColor="#424242"/>
            <Editor x:Name="NotesEditor"
                    HeightRequest="100"
                    BackgroundColor="#F5F5F5"
                    Placeholder="Voer opmerkingen in..."/>
            
            <!-- DeliveryItems Sectie -->
            <Label Text="Producten"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="#212121"
                   Margin="0,20,0,10"/>
            
            <Border BackgroundColor="#F5F5F5"
                    Stroke="#E0E0E0"
                    StrokeThickness="1"
                    Padding="10"
                    MinimumHeightRequest="150">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>
                
                <CollectionView x:Name="DeliveryItemsCollection"
                              SelectionMode="None">
                    <CollectionView.EmptyView>
                        <Label Text="Geen producten toegevoegd"
                             FontSize="14"
                             TextColor="Gray"
                             HorizontalTextAlignment="Center"
                             VerticalTextAlignment="Center"
                             Padding="20"/>
                    </CollectionView.EmptyView>
                    
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:DeliveryItem">
                            <Border BackgroundColor="White"
                                  Stroke="#E0E0E0"
                                  StrokeThickness="1"
                                  Padding="10"
                                  Margin="0,5">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="6"/>
                                </Border.StrokeShape>
                                
                                <Grid ColumnDefinitions="*,Auto,Auto">
                                    <VerticalStackLayout Grid.Column="0">
                                        <Label Text="{Binding Product.ProductName}"
                                             FontSize="14"
                                             FontAttributes="Bold"/>
                                        <Label FontSize="12"
                                             TextColor="Gray">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding Quantity}"/>
                                                    <Span Text=" x EUR "/>
                                                    <Span Text="{Binding UnitPrice, StringFormat='{0:F2}'}"/>
                                                    <Span Text=" = EUR "/>
                                                    <Span Text="{Binding Total, StringFormat='{0:F2}'}"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </VerticalStackLayout>
                                    
                                    <Button Grid.Column="2"
                                          Text="X"
                                          FontSize="14"
                                          BackgroundColor="#DC2626"
                                          TextColor="White"
                                          WidthRequest="40"
                                          HeightRequest="40"
                                          CornerRadius="20"
                                          Clicked="OnRemoveItemClicked"
                                          CommandParameter="{Binding .}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Border>
            
            <Button x:Name="AddItemButton"
                    Text="+ Product Toevoegen"
                    FontSize="14"
                    BackgroundColor="#512BD4"
                    TextColor="White"
                    Padding="15,10"
                    CornerRadius="8"
                    Clicked="OnAddItemClicked"/>
            
            <!-- Totaal Bedrag -->
            <Border BackgroundColor="#F5F5F5"
                    Stroke="#E0E0E0"
                    StrokeThickness="1"
                    Padding="15"
                    Margin="0,10,0,0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>
                
                <Grid ColumnDefinitions="*,Auto">
                    <Label Grid.Column="0"
                         Text="Totaal Bedrag:"
                         FontSize="18"
                         FontAttributes="Bold"
                         VerticalOptions="Center"/>
                    <Label x:Name="TotalAmountLabel"
                         Grid.Column="1"
                         Text="EUR 0.00"
                         FontSize="18"
                         FontAttributes="Bold"
                         TextColor="#16A34A"
                         VerticalOptions="Center"/>
                </Grid>
            </Border>
            
            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*"
                  ColumnSpacing="10"
                  Margin="0,20,0,0">
                <Button Grid.Column="0"
                      Text="Annuleren"
                      FontSize="14"
                      BackgroundColor="#6B7280"
                      TextColor="White"
                      Padding="15,12"
                      CornerRadius="8"
                      Clicked="OnCancelClicked"/>
                <Button x:Name="SaveButton"
                      Grid.Column="1"
                      Text="Opslaan"
                      FontSize="14"
                      BackgroundColor="#512BD4"
                      TextColor="White"
                      Padding="15,12"
                      CornerRadius="8"
                      Clicked="OnSaveClicked"/>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
